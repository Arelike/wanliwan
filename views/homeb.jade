extends layout

block append head
  block title 
    title home

  link(href='/stylesheets/homeb.css',rel='stylesheet')
  link(rel="stylesheet",type="text/css",href="/stylesheets/bootstrap-wysihtml5.css")
  link(rel="stylesheet",type="text/css",href="/stylesheets/text.css")

  script(src='/javascripts/wysihtml5-0.3.0.js')
  script(src='/javascripts/bootstrap-wysihtml5.js')
  script(src='/javascripts/prettify.js')

  script(src='/javascripts/toggleelement.jquery.js')
  script(src='/javascripts/page.js')

  script
    (function () {
      "use strict"

      $(function () {
        window.overlay = {
          _obj: $('<div></div>').css({
            position: 'fixed', 
            left: '0', top: '0', width:'100%', height:'100%',
            display: 'none',
            backgroundColor: 'rgba(22,22,22,0.85)'
          }).appendTo(document.body),
          show: function () {
            this._obj.fadeIn();
          },
          hide: function () {
            this._obj.hide();
          }
        };
        overlay._obj.click(function () {
          page('/homeb');
        });
        
        page();
      });
      
      page('/home(*)', home);
      page('/new/:type(*)', newTextPopup);

      function newTextPopup(ctx) {
        $.get('/new/'+ctx.params.type).success(function (data) {
          $('#new-post-area').html(data).slideDown();
          $('#new-post-area form').submit(function (event) {
            event.preventDefault();
            var $this = $(this);
            var data = $this.serializeArray();
            $.post('/new/'+ctx.params.type, data).success(function (data) {
              var o = $('<div class="tip"></div>').html(data).hide();
              $('#posts-list').prepend(o);
              o.slideDown();
              page('/homeb/');
            }).error(function (data) {
              alert('错误了～');
            });
          });
          overlay.show();
        }).error(function (data) {
          $('#new-post-area').html('大哥手下留情，我们很快就会完善的了……').slideDown();
          overlay.show();
        });
      }

      function home(ctx) {
        $('#new-post-area').slideUp();
        overlay.hide();
      }

    })();

block body
  #everything
    .header
      .avatar
        img(src="/images/2.png",alt="img")
      
      .navigator
        ul.nav
          li
            a(href="/new/text")#new-post-btn.pjax
              i.icon-pencil.icon-3x
              br
              span 文字
          li
            a(href="/new/photo")
              i.icon-camera-retro.icon-3x
              br
              span 图片
          li
            a(href="/new/music")
              i.icon-music.icon-3x
              br
              span 音乐
          li
            a(href="/new/video")
              i.icon-facetime-video.icon-3x
              br
              span 视频
          li
            a(href="/new/link")
              i.icon-link.icon-3x
              br
              span 链接
          li
            a(href="/new/bell")
              i.icon-quote-right.icon-3x
              br
              span 签名
          li
            a(href="/new/bell")
              i.icon-bell.icon-3x
              br
              span @伊
        .clearfix
        #new-post-area 
          block new-post-area
      .sign
        p 有志者事竟成,破釜沉舟,百二秦关终属楚;苦心人天不负,卧薪尝胆,三千越甲可吞吴。
        
      .clearfix
    .content
      #posts-list.posts
        include post
      .rightbar
        include rightbar
      .clearfix
    .footer
